
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>Syntax - Fast</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#syntax" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Fast" class="md-header__button md-logo" aria-label="Fast" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fast
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Syntax
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jonatas/fast" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Fast" class="md-nav__button md-logo" aria-label="Fast" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Fast
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jonatas/fast" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../walkthrough/" class="md-nav__link">
        Walkthrough
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Syntax
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Syntax
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-example" class="md-nav__link">
    Code example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-represent-a-node-search" class="md-nav__link">
    () to represent a node search
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_-is-something-not-nil" class="md-nav__link">
    _ is something not nil
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../command_line/" class="md-nav__link">
        Command Line
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../experiments/" class="md-nav__link">
        Experiments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../shortcuts/" class="md-nav__link">
        Shortcuts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../git/" class="md-nav__link">
        Git Integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../similarity_tutorial/" class="md-nav__link">
        Code Similarity
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pry-integration/" class="md-nav__link">
        Pry Integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../editors-integration/" class="md-nav__link">
        Editors' Integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../research/" class="md-nav__link">
        Research
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ideas/" class="md-nav__link">
        Ideas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../videos/" class="md-nav__link">
        Videos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sql-support/" class="md-nav__link">
        SQL Support
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-example" class="md-nav__link">
    Code example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-represent-a-node-search" class="md-nav__link">
    () to represent a node search
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_-is-something-not-nil" class="md-nav__link">
    _ is something not nil
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/jonatas/fast/edit/master/docs/syntax.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="syntax">Syntax<a class="headerlink" href="#syntax" title="Permanent link">&para;</a></h1>
<p>The syntax is inspired on <a href="https://github.com/bbatsov/rubocop/blob/master/lib/rubocop/node_pattern.rb">RuboCop Node Pattern</a>.</p>
<p>You can find a great tutorial about RuboCop node pattern in the
<a href="https://rubocop.readthedocs.io/en/latest/node_pattern/">official documentation</a>.</p>
<h2 id="code-example">Code example<a class="headerlink" href="#code-example" title="Permanent link">&para;</a></h2>
<p>Let's consider the following <code>example.rb</code> code example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Example</span>
  <span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Looking the AST representation we have:</p>
<pre><code>$ ruby-parse example.rb
</code></pre>
<div class="highlight"><pre><span></span><code>(class
  (const nil :Example) nil
  (begin
    (casgn nil :ANSWER
      (int 42))
    (def :magic
      (args)
      (send nil :rand
        (const nil :ANSWER)))
    (def :duplicate
      (args
        (arg :value))
      (send
        (lvar :value) :*
        (int 2)))))
</code></pre></div>
<p>Now, let's explore all details of the current AST, combining with the syntax
operators.</p>
<p>Fast works with a single word that will be the node type.</p>
<p>A simple search of <code>def</code> nodes can be done and will also print the code.</p>
<pre><code>$ fast def example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:3</span>
  <span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div>
<p>or check the <code>casgn</code> that will show constant assignments:</p>
<pre><code>$ fast casgn example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div>
<h2 id="to-represent-a-node-search"><code>()</code> to represent a <strong>node</strong> search<a class="headerlink" href="#to-represent-a-node-search" title="Permanent link">&para;</a></h2>
<p>To specify details about a node, the <code>(</code> means navigate deeply into a node and
go deep into the expression.</p>
<pre><code>$ fast '(casgn' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div>
<p>Fast matcher never checks the end of the expression and close parens are not
necessary. We keep them for the sake of specify more node details but the
expression works with incomplete parens.</p>
<pre><code>$ fast '(casgn)' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div>
<p>Closing extra params also don't have a side effect.</p>
<pre><code>$ fast '(casgn))' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div>
<p>It also automatically flat parens case you put more levels in the beginning.</p>
<pre><code>$ fast '((casgn))' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div>
<p>For checking AST details while doing some search, you can use <code>--ast</code> in the
command line for printing the AST instead of the code:</p>
<pre><code>$ fast '((casgn ' example.rb --ast
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="p">(</span><span class="n">casgn</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span>
  <span class="p">(</span><span class="n">int</span> <span class="mi">42</span><span class="p">))</span>
</code></pre></div>
<h2 id="_-is-something-not-nil"><code>_</code> is <strong>something</strong> not nil<a class="headerlink" href="#_-is-something-not-nil" title="Permanent link">&para;</a></h2>
<p>Let's enhance our current expression and specify that we're looking for constant
assignments of integers ignoring values and constant names replacing with <code>_</code>.</p>
<pre><code>$ fast '(casgn nil _ (int _))' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div>
<p>Keep in mind that <code>_</code> means not nil and  <code>(casgn _ _ (int  _))</code> would not
match.</p>
<p>Let's search for integer nodes:</p>
<pre><code>$ fast int example.rb
</code></pre>
<p>```ruby</p>
<h1 id="examplerb2">example.rb:2<a class="headerlink" href="#examplerb2" title="Permanent link">&para;</a></h1>
<p>42</p>
<h1 id="examplerb7">example.rb:7<a class="headerlink" href="#examplerb7" title="Permanent link">&para;</a></h1>
<p>2
```</p>
<p>The current search show the nodes but they are not so useful without understand
the expression in their context. We need to check their <code>parent</code>.</p>
<h2 id="is-to-get-the-parent-node-of-an-expression"><code>^</code> is to get the <strong>parent node</strong> of an expression<a class="headerlink" href="#is-to-get-the-parent-node-of-an-expression" title="Permanent link">&para;</a></h2>
<p>By default, Parser::AST::Node  does not have access to parent and for accessing
it you can say <code>^</code> for reaching the parent.</p>
<pre><code>$ fast '^int' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
<span class="c1"># example.rb:7</span>
<span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
</code></pre></div>
<p>And using it multiple times will make the node match from levels up:</p>
<pre><code>$ fast '^^int' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
</code></pre></div>
<h2 id="join-conditions"><code>[]</code> join conditions<a class="headerlink" href="#join-conditions" title="Permanent link">&para;</a></h2>
<p>Let's hunt for integer nodes that the parent is also a method:</p>
<pre><code>$ fast '[ ^^int def ]' example.rb
</code></pre>
<p>The match will filter only nodes that matches all internal expressions.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:6</span>
<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
</code></pre></div>
<p>The expression is matching nodes that have a integer granchild and also with
type <code>def</code>.</p>
<h2 id="is-a-node-with-children"><code>...</code> is a <strong>node</strong> with children<a class="headerlink" href="#is-a-node-with-children" title="Permanent link">&para;</a></h2>
<p>Looking the method representation we have:</p>
<pre><code>$ fast def example.rb --ast
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:3</span>
<span class="p">(</span><span class="k">def</span> <span class="ss">:magic</span>
  <span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">send</span> <span class="kp">nil</span> <span class="ss">:rand</span>
    <span class="p">(</span><span class="n">const</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span><span class="p">)))</span>
<span class="c1"># example.rb:6</span>
<span class="p">(</span><span class="k">def</span> <span class="ss">:duplicate</span>
  <span class="p">(</span><span class="n">args</span>
    <span class="p">(</span><span class="n">arg</span> <span class="ss">:value</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">send</span>
    <span class="p">(</span><span class="n">lvar</span> <span class="ss">:value</span><span class="p">)</span> <span class="ss">:*</span>
    <span class="p">(</span><span class="n">int</span> <span class="mi">2</span><span class="p">)))</span>
</code></pre></div>
<p>And if we want to delimit only methods with arguments:</p>
<pre><code>$ fast '(def _ ...)' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:6</span>
<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
</code></pre></div>
<p>If we use <code>(def _ _)</code> instead it will match both methods because <code>(args)</code> 
does not have children but is not nil.</p>
<h2 id="is-for-capture-current-expression"><code>$</code> is for <strong>capture</strong> current expression<a class="headerlink" href="#is-for-capture-current-expression" title="Permanent link">&para;</a></h2>
<p>Now, let's say we want to extract some method name from current classes.</p>
<p>In such case we don't want to have the node definition but only return the node
name.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:2</span>
<span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
<span class="c1"># example.rb:</span>
<span class="n">magic</span>
<span class="c1"># example.rb:9</span>
<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="c1"># example.rb:</span>
<span class="n">duplicate</span>
</code></pre></div>
<p>One extra method name was printed because of <code>$</code> is capturing the element.</p>
<h2 id="nil-matches-exactly-nil"><code>nil</code> matches exactly <strong>nil</strong><a class="headerlink" href="#nil-matches-exactly-nil" title="Permanent link">&para;</a></h2>
<p>Nil is used in the code as a node type but parser gem also represents empty
spaces in expressions with nil.</p>
<p>Example, a method call from Kernel is a <code>send</code> from <code>nil</code> calling the method
while I can also send a method call from a class.</p>
<div class="highlight"><pre><span></span><code>$ ruby-parse -e &#39;method&#39;
(send nil :method)
</code></pre></div>
<p>And a method from a object will have the nested target not nil.</p>
<div class="highlight"><pre><span></span><code>$ ruby-parse -e &#39;object.method&#39;
(send
  (send nil :object) :method)
</code></pre></div>
<p>Let's build a serch for any calls from <code>nil</code>:</p>
<pre><code>$ fast '(_ nil _)' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:3</span>
<span class="no">Example</span>
<span class="c1"># example.rb:4</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
<span class="c1"># example.rb:6</span>
<span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
</code></pre></div>
<p>Double check the expressions that have matched printing the AST:</p>
<pre><code>$ fast '(_ nil _)' example.rb --ast
</code></pre>
<div class="highlight"><pre><span></span><code><span class="c1"># example.rb:3</span>
<span class="p">(</span><span class="n">const</span> <span class="kp">nil</span> <span class="ss">:Example</span><span class="p">)</span>
<span class="c1"># example.rb:4</span>
<span class="p">(</span><span class="n">casgn</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span>
  <span class="p">(</span><span class="n">int</span> <span class="mi">42</span><span class="p">))</span>
<span class="c1"># example.rb:6</span>
<span class="p">(</span><span class="nb">send</span> <span class="kp">nil</span> <span class="ss">:rand</span>
  <span class="p">(</span><span class="n">const</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span><span class="p">))</span>
</code></pre></div>
<h2 id="is-for-any-matches-like-union-conditions-with-or-operator"><code>{}</code> is for <strong>any</strong> matches like <strong>union</strong> conditions with <strong>or</strong> operator<a class="headerlink" href="#is-for-any-matches-like-union-conditions-with-or-operator" title="Permanent link">&para;</a></h2>
<p>Let's say we to add check all occurrencies of the constant <code>ANSWER</code>.</p>
<p>We'll need to get both <code>casgn</code> and <code>const</code> node types. For such cases we can
surround the expressions with <code>{}</code> and it will return if the node matches with
any of the internal expressions.</p>
<pre><code>$ fast '({casgn const} nil ANSWER)' example.rb
</code></pre>
<div class="highlight"><pre><span></span><code># example.rb:4
ANSWER = 42
# example.rb:6
ANSWER
</code></pre></div>
<h2 id="for-custom-methods"><code>#</code> for custom methods<a class="headerlink" href="#for-custom-methods" title="Permanent link">&para;</a></h2>
<p>Custom methods can let you into ruby doman for more complicated rules. Let's say
we're looking for duplicated methods in the same class. We need to collect
method names and guarantee they are unique.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">duplicated</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
  <span class="vi">@methods</span> <span class="o">||=</span> <span class="o">[]</span>
  <span class="n">already_exists</span> <span class="o">=</span> <span class="vi">@methods</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
  <span class="vi">@methods</span> <span class="o">&lt;&lt;</span> <span class="n">method_name</span>
  <span class="n">already_exists</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span> <span class="s1">&#39;(def #duplicated)&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</code></pre></div>
The same principle can be used in the node level or for debugging purposes.</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">require</span> <span class="s1">&#39;pry&#39;</span>
<span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
  <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span><span class="s1">&#39;#debug&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</code></pre></div>
If you want to get only <code>def</code> nodes you can also intersect expressions with <code>[]</code>:
<div class="highlight"><pre><span></span><code><span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span><span class="s1">&#39;[ def #debug ]&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</code></pre></div>
Or if you want to debug a very specific expression you can use <code>()</code> to specify
more details of the node
<div class="highlight"><pre><span></span><code><span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span><span class="s1">&#39;[ (def a) #debug ]&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="for-instance-methods"><code>.</code> for instance methods<a class="headerlink" href="#for-instance-methods" title="Permanent link">&para;</a></h2>
<p>You can also call instance methods using <code>.&lt;method-name&gt;</code>.</p>
<p>Example <code>nil</code> is the same of calling <code>nil?</code> and you can also use <code>(int .odd?)</code>
to pick only odd integers. The <code>int</code> fragment can also be <code>int_type?</code>.</p>
<h2 id="1-for-first-previous-capture"><code>\1</code> for first previous capture<a class="headerlink" href="#1-for-first-previous-capture" title="Permanent link">&para;</a></h2>
<p>Imagine you're looking for a method that is just delegating something to
another method, like:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">name</span>
  <span class="n">person</span><span class="o">.</span><span class="n">name</span>
<span class="k">end</span>
</code></pre></div>
<p>This can be represented as the following AST:</p>
<div class="highlight"><pre><span></span><code>(def :name
  (args)
  (send
    (send nil :person) :name))
</code></pre></div>
<p>Then, let's build a search for methods that calls an attribute with the same
name:</p>
<div class="highlight"><pre><span></span><code><span class="no">Fast</span><span class="o">.</span><span class="n">match?</span><span class="p">(</span><span class="s1">&#39;(def $_ ... (send (send nil _) </span><span class="se">\1</span><span class="s1">))&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="p">)</span> <span class="c1"># =&gt; [:name]</span>
</code></pre></div>
<p>With the method name being captured with <code>$_</code> it can be later referenced in the
expression with <code>\1</code>. If the search contains multiple captures, the <code>\2</code>,<code>\3</code>
can be used as the sequence of captures.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../walkthrough/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Walkthrough" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Walkthrough
            </div>
          </div>
        </a>
      
      
        
        <a href="../command_line/" class="md-footer__link md-footer__link--next" aria-label="Next: Command Line" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Command Line
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>
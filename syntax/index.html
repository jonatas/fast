



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.3, mkdocs-material-3.0.3">
    
    
      
        <title>Syntax - Fast</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#syntax" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Fast" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Fast
              </span>
              <span class="md-header-nav__topic">
                Syntax
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/jonatas/fast/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Fast" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Fast
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/jonatas/fast/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Syntax
      </label>
    
    <a href="./" title="Syntax" class="md-nav__link md-nav__link--active">
      Syntax
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-example" title="Code example" class="md-nav__link">
    Code example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-represent-a-node-search" title="() to represent a node search" class="md-nav__link">
    () to represent a node search
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_-is-something-not-nil" title="_ is something not nil" class="md-nav__link">
    _ is something not nil
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-to-get-the-parent-node-of-an-expression" title="^ is to get the parent node of an expression" class="md-nav__link">
    ^ is to get the parent node of an expression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-conditions" title="[] join conditions" class="md-nav__link">
    [] join conditions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-a-node-with-children" title="... is a node with children" class="md-nav__link">
    ... is a node with children
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-for-capture-current-expression" title="$ is for capture current expression" class="md-nav__link">
    $ is for capture current expression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nil-matches-exactly-nil" title="nil matches exactly nil" class="md-nav__link">
    nil matches exactly nil
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-for-any-matches-like-union-conditions-with-or-operator" title="{} is for any matches like union conditions with or operator" class="md-nav__link">
    {} is for any matches like union conditions with or operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-custom-methods" title="Calling Custom Methods" class="md-nav__link">
    Calling Custom Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-instance-methods" title="Calling Instance Methods" class="md-nav__link">
    Calling Instance Methods
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../command_line/" title="Command Line" class="md-nav__link">
      Command Line
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../experiments/" title="Experiments" class="md-nav__link">
      Experiments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../similarity_tutorial/" title="Code Similarity" class="md-nav__link">
      Code Similarity
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../pry-integration/" title="Pry Integration" class="md-nav__link">
      Pry Integration
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-example" title="Code example" class="md-nav__link">
    Code example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-represent-a-node-search" title="() to represent a node search" class="md-nav__link">
    () to represent a node search
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_-is-something-not-nil" title="_ is something not nil" class="md-nav__link">
    _ is something not nil
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-to-get-the-parent-node-of-an-expression" title="^ is to get the parent node of an expression" class="md-nav__link">
    ^ is to get the parent node of an expression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-conditions" title="[] join conditions" class="md-nav__link">
    [] join conditions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-a-node-with-children" title="... is a node with children" class="md-nav__link">
    ... is a node with children
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-for-capture-current-expression" title="$ is for capture current expression" class="md-nav__link">
    $ is for capture current expression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nil-matches-exactly-nil" title="nil matches exactly nil" class="md-nav__link">
    nil matches exactly nil
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-for-any-matches-like-union-conditions-with-or-operator" title="{} is for any matches like union conditions with or operator" class="md-nav__link">
    {} is for any matches like union conditions with or operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-custom-methods" title="Calling Custom Methods" class="md-nav__link">
    Calling Custom Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-instance-methods" title="Calling Instance Methods" class="md-nav__link">
    Calling Instance Methods
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jonatas/fast/edit/master/docs/syntax.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="syntax">Syntax<a class="headerlink" href="#syntax" title="Permanent link">&para;</a></h1>
<p>The syntax is inspired on <a href="https://github.com/bbatsov/rubocop/blob/master/lib/rubocop/node_pattern.rb">RuboCop Node Pattern</a>.</p>
<p>You can find a great tutorial about RuboCop node pattern in the
<a href="https://rubocop.readthedocs.io/en/latest/node_pattern/">official documentation</a>.</p>
<h2 id="code-example">Code example<a class="headerlink" href="#code-example" title="Permanent link">&para;</a></h2>
<p>Let's consider the following <code>example.rb</code> code example:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Example</span>
  <span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p>Looking the AST representation we have:</p>
<div class="codehilite"><pre><span></span>$ ruby-parse example.rb
</pre></div>


<div class="codehilite"><pre><span></span>(class
  (const nil :Example) nil
  (begin
    (casgn nil :ANSWER
      (int 42))
    (def :magic
      (args)
      (send nil :rand
        (const nil :ANSWER)))
    (def :duplicate
      (args
        (arg :value))
      (send
        (lvar :value) :*
        (int 2)))))
</pre></div>


<p>Now, let's explore all details of the current AST, combining with the syntax
operators.</p>
<p>Fast works with a single word that will be the node type.</p>
<p>A simple search of <code>def</code> nodes can be done and will also print the code.</p>
<div class="codehilite"><pre><span></span>$ fast def example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:3</span>
  <span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
</pre></div>


<p>or check the <code>casgn</code> that will show constant assignments:</p>
<div class="codehilite"><pre><span></span>$ fast casgn example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>


<h2 id="to-represent-a-node-search"><code>()</code> to represent a <strong>node</strong> search<a class="headerlink" href="#to-represent-a-node-search" title="Permanent link">&para;</a></h2>
<p>To specify details about a node, the <code>(</code> means navigate deeply into a node and
go deep into the expression.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(casgn&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>


<p>Fast matcher never checks the end of the expression and close parens are not
necessary. We keep them for the sake of specify more node details but the
expression works with incomplete parens.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(casgn)&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>


<p>Closing extra params also don't have a side effect.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(casgn))&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>


<p>It also automatically flat parens case you put more levels in the beginning.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;((casgn))&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>


<p>For checking AST details while doing some search, you can use <code>--ast</code> in the
command line for printing the AST instead of the code:</p>
<div class="codehilite"><pre><span></span>$ fast &#39;((casgn &#39; example.rb --ast
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="p">(</span><span class="n">casgn</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span>
  <span class="p">(</span><span class="n">int</span> <span class="mi">42</span><span class="p">))</span>
</pre></div>


<h2 id="_-is-something-not-nil"><code>_</code> is <strong>something</strong> not nil<a class="headerlink" href="#_-is-something-not-nil" title="Permanent link">&para;</a></h2>
<p>Let's enhance our current expression and specify that we're looking for constant
assignments of integers ignoring values and constant names replacing with <code>_</code>.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(casgn nil _ (int _))&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>


<p>Keep in mind that <code>_</code> means not nil and  <code>(casgn _ _ (int  _))</code> would not
match.</p>
<p>Let's search for integer nodes:</p>
<div class="codehilite"><pre><span></span>$ fast int example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="mi">42</span>
<span class="c1"># example.rb:7</span>
<span class="mi">2</span>
</pre></div>


<p>The current search show the nodes but they are not so useful without understand
the expression in their context. We need to check their <code>parent</code>.</p>
<h2 id="is-to-get-the-parent-node-of-an-expression"><code>^</code> is to get the <strong>parent node</strong> of an expression<a class="headerlink" href="#is-to-get-the-parent-node-of-an-expression" title="Permanent link">&para;</a></h2>
<p>By default, Parser::AST::Node  does not have access to parent and for accessing
it you can say <code>^</code> for reaching the parent.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;^int&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
<span class="c1"># example.rb:7</span>
<span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
</pre></div>


<p>And using it multiple times will make the node match from levels up:</p>
<div class="codehilite"><pre><span></span>$ fast &#39;^^int&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
</pre></div>


<h2 id="join-conditions"><code>[]</code> join conditions<a class="headerlink" href="#join-conditions" title="Permanent link">&para;</a></h2>
<p>Let's hunt for integer nodes that the parent is also a method:</p>
<div class="codehilite"><pre><span></span>$ fast &#39;[ ^^int def ]&#39; example.rb
</pre></div>


<p>The match will filter only nodes that matches all internal expressions.</p>
<div class="codehilite"><pre><span></span><span class="c1"># example.rb:6</span>
<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
</pre></div>


<p>The expression is matching nodes that have a integer granchild and also with
type <code>def</code>.</p>
<h2 id="is-a-node-with-children"><code>...</code> is a <strong>node</strong> with children<a class="headerlink" href="#is-a-node-with-children" title="Permanent link">&para;</a></h2>
<p>Looking the method representation we have:</p>
<div class="codehilite"><pre><span></span>$ fast def example.rb --ast
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:3</span>
<span class="p">(</span><span class="k">def</span> <span class="ss">:magic</span>
  <span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">send</span> <span class="kp">nil</span> <span class="ss">:rand</span>
    <span class="p">(</span><span class="n">const</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span><span class="p">)))</span>
<span class="c1"># example.rb:6</span>
<span class="p">(</span><span class="k">def</span> <span class="ss">:duplicate</span>
  <span class="p">(</span><span class="n">args</span>
    <span class="p">(</span><span class="n">arg</span> <span class="ss">:value</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">send</span>
    <span class="p">(</span><span class="n">lvar</span> <span class="ss">:value</span><span class="p">)</span> <span class="ss">:*</span>
    <span class="p">(</span><span class="n">int</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>


<p>And if we want to delimit only methods with arguments:</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(def _ ...)&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:6</span>
<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
</pre></div>


<p>If we use <code>(def _ _)</code> instead it will match both methods because <code>(args)</code> 
does not have children but is not nil.</p>
<h2 id="is-for-capture-current-expression"><code>$</code> is for <strong>capture</strong> current expression<a class="headerlink" href="#is-for-capture-current-expression" title="Permanent link">&para;</a></h2>
<p>Now, let's say we want to extract some method name from current classes.</p>
<p>In such case we don't want to have the node definition but only return the node
name.</p>
<div class="codehilite"><pre><span></span><span class="c1"># example.rb:2</span>
<span class="k">def</span> <span class="nf">magic</span>
    <span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
  <span class="k">end</span>
<span class="c1"># example.rb:</span>
<span class="n">magic</span>
<span class="c1"># example.rb:9</span>
<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="c1"># example.rb:</span>
<span class="n">duplicate</span>
</pre></div>


<p>One extra method name was printed because of <code>$</code> is capturing the element.</p>
<p>Let's use the <code>--pry</code> for inspecting the results.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(def $_)&#39; example.rb --pry
</pre></div>


<p>It will open pry with access to <code>result</code> as the first result and
<code>results</code> with all matching results.</p>
<div class="codehilite"><pre><span></span>From: /Users/jonatasdp/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/ffast-0.0.2/bin/fast @ line 60 :

    55:
    56:   results.each do |result|
    57:     next if result.nil? || result == []
    58:     if pry
    59:       require &#39;pry&#39;
 =&gt; 60:       binding.pry # rubocop:disable Lint/Debugger
    61:     else
    62:       Fast.report(result, file: file, show_sexp: show_sexp)
    63:     end
    64:   end
    65: end
</pre></div>


<p>Inspecting the results you can see that they are mixing AST nodes and the
captures.</p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">results</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="n">s</span><span class="p">(</span><span class="ss">:def</span><span class="p">,</span> <span class="ss">:magic</span><span class="p">,</span>
  <span class="n">s</span><span class="p">(</span><span class="ss">:args</span><span class="p">),</span>
  <span class="n">s</span><span class="p">(</span><span class="ss">:send</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">:rand</span><span class="p">,</span>
    <span class="n">s</span><span class="p">(</span><span class="ss">:const</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">:ANSWER</span><span class="p">))),</span>
 <span class="ss">:magic</span><span class="p">,</span>
 <span class="n">s</span><span class="p">(</span><span class="ss">:def</span><span class="p">,</span> <span class="ss">:duplicate</span><span class="p">,</span>
  <span class="n">s</span><span class="p">(</span><span class="ss">:args</span><span class="p">,</span>
    <span class="n">s</span><span class="p">(</span><span class="ss">:arg</span><span class="p">,</span> <span class="ss">:value</span><span class="p">)),</span>
  <span class="n">s</span><span class="p">(</span><span class="ss">:send</span><span class="p">,</span>
    <span class="n">s</span><span class="p">(</span><span class="ss">:lvar</span><span class="p">,</span> <span class="ss">:value</span><span class="p">),</span> <span class="ss">:*</span><span class="p">,</span>
    <span class="n">s</span><span class="p">(</span><span class="ss">:int</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span>
 <span class="ss">:duplicate</span><span class="o">]</span>
</pre></div>


<p>We can filter the captures to make it easy to analyze.</p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:magic</span><span class="p">,</span> <span class="ss">:duplicate</span><span class="o">]</span>
</pre></div>


<h2 id="nil-matches-exactly-nil"><code>nil</code> matches exactly <strong>nil</strong><a class="headerlink" href="#nil-matches-exactly-nil" title="Permanent link">&para;</a></h2>
<p>Nil is used in the code as a node type but parser gem also represents empty
spaces in expressions with nil.</p>
<p>Example, a method call from Kernel is a <code>send</code> from <code>nil</code> calling the method
while I can also send a method call from a class.</p>
<div class="codehilite"><pre><span></span>$ ruby-parse -e &#39;method&#39;
(send nil :method)
</pre></div>


<p>And a method from a object will have the nested target not nil.</p>
<div class="codehilite"><pre><span></span>$ ruby-parse -e &#39;object.method&#39;
(send
  (send nil :object) :method)
</pre></div>


<p>Let's build a serch for any calls from <code>nil</code>:</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(_ nil _)&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:3</span>
<span class="no">Example</span>
<span class="c1"># example.rb:4</span>
<span class="no">ANSWER</span> <span class="o">=</span> <span class="mi">42</span>
<span class="c1"># example.rb:6</span>
<span class="nb">rand</span><span class="p">(</span><span class="no">ANSWER</span><span class="p">)</span>
</pre></div>


<p>Double check the expressions that have matched printing the AST:</p>
<div class="codehilite"><pre><span></span>$ fast &#39;(_ nil _)&#39; example.rb --ast
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># example.rb:3</span>
<span class="p">(</span><span class="n">const</span> <span class="kp">nil</span> <span class="ss">:Example</span><span class="p">)</span>
<span class="c1"># example.rb:4</span>
<span class="p">(</span><span class="n">casgn</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span>
  <span class="p">(</span><span class="n">int</span> <span class="mi">42</span><span class="p">))</span>
<span class="c1"># example.rb:6</span>
<span class="p">(</span><span class="nb">send</span> <span class="kp">nil</span> <span class="ss">:rand</span>
  <span class="p">(</span><span class="n">const</span> <span class="kp">nil</span> <span class="ss">:ANSWER</span><span class="p">))</span>
</pre></div>


<h2 id="is-for-any-matches-like-union-conditions-with-or-operator"><code>{}</code> is for <strong>any</strong> matches like <strong>union</strong> conditions with <strong>or</strong> operator<a class="headerlink" href="#is-for-any-matches-like-union-conditions-with-or-operator" title="Permanent link">&para;</a></h2>
<p>Let's say we to add check all occurrencies of the constant <code>ANSWER</code>.</p>
<p>We'll need to get both <code>casgn</code> and <code>const</code> node types. For such cases we can
surround the expressions with <code>{}</code> and it will return if the node matches with
any of the internal expressions.</p>
<div class="codehilite"><pre><span></span>$ fast &#39;({casgn const} nil ANSWER)&#39; example.rb
</pre></div>


<div class="codehilite"><pre><span></span># example.rb:4
ANSWER = 42
# example.rb:6
ANSWER
</pre></div>


<h2 id="calling-custom-methods">Calling Custom Methods<a class="headerlink" href="#calling-custom-methods" title="Permanent link">&para;</a></h2>
<p>Custom methods can let you into ruby doman for more complicated rules. Let's say
we're looking for duplicated methods in the same class. We need to collect
method names and guarantee they are unique.</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">duplicated</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
  <span class="vi">@methods</span> <span class="o">||=</span> <span class="o">[]</span>
  <span class="n">already_exists</span> <span class="o">=</span> <span class="vi">@methods</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
  <span class="vi">@methods</span> <span class="o">&lt;&lt;</span> <span class="n">method_name</span>
  <span class="n">already_exists</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span> <span class="s1">&#39;(def #duplicated)&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</pre></div>


<p>The same principle can be used in the node level or for debugging purposes.</p>
<div class="codehilite"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;pry&#39;</span>
<span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
  <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span><span class="s1">&#39;#debug&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</pre></div>


<p>If you want to get only <code>def</code> nodes you can also intersect expressions with <code>[]</code>:</p>
<div class="codehilite"><pre><span></span><span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span><span class="s1">&#39;[ def #debug ]&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</pre></div>


<p>Or if you want to debug a very specific expression you can use <code>()</code> to specify
more details of the node</p>
<div class="codehilite"><pre><span></span><span class="nb">puts</span> <span class="no">Fast</span><span class="o">.</span><span class="n">search_file</span><span class="p">(</span><span class="s1">&#39;[ (def a) #debug ]&#39;</span><span class="p">,</span> <span class="s1">&#39;example.rb&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="calling-instance-methods">Calling Instance Methods<a class="headerlink" href="#calling-instance-methods" title="Permanent link">&para;</a></h2>
<p>You can also call instance methods using <code>.&lt;method-name&gt;</code>.</p>
<p>Example <code>nil</code> is the same of calling <code>nil?</code> and you can also use <code>(int .odd?)</code>
to pick only odd integers. The <code>int</code> fragment can also be <code>int_type?</code>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
          <a href="../command_line/" title="Command Line" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Command Line
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.3",url:{base:".."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125089529-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>